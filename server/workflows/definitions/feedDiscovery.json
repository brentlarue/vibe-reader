{
  "id": "feed-discovery",
  "name": "Feed Discovery",
  "steps": [
    {
      "id": "generate_candidates",
      "name": "Generate Candidate Feeds",
      "type": "llm",
      "model": "gpt-4o-mini",
      "promptSystem": "You are an expert at discovering high-quality RSS feeds based on user interests, writing styles, and criteria. You understand the RSS ecosystem and can identify feeds from authors, publications, and thought leaders.",
      "promptUser": "Based on the user's input, generate a list of candidate RSS feeds that match their interests and criteria.\n\nUser Interests:\n{{input.interests}}\n\nUser Criteria (MUST FOLLOW STRICTLY):\n{{input.criteria}}\n\nIMPORTANT: If the criteria specifies \"ONLY FROM AUTHORS, NOT PUBLICATIONS\" or similar restrictions, you MUST:\n- Only include feeds from individual authors, bloggers, or personal newsletters\n- EXCLUDE feeds from publications, news sites, magazines, or multi-author platforms\n- Examples of publications to EXCLUDE: NPR, TechCrunch, Wired, The Verge, Ars Technica, etc.\n- Examples of authors to INCLUDE: individual bloggers, Substack authors, personal newsletters, individual Medium authors\n\nGenerate a JSON array of candidate feeds. Each feed should have:\n- name: Author or publication name\n- description: Brief description of why this feed matches\n- websiteUrl: The main website URL (not the RSS URL yet)\n- whyFit: Explanation of how this matches the user's criteria (including why it's an author feed if criteria requires authors only)\n- confidenceHint: A brief hint about the confidence level (high/medium/low)\n\nReturn a JSON object with a 'feeds' array containing at least 10-15 candidates for broad recall, but ONLY if they match the criteria restrictions.",
      "outputSchema": {
        "type": "object",
        "properties": {
          "feeds": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "name": { "type": "string" },
                "description": { "type": "string" },
                "websiteUrl": { "type": "string" },
                "whyFit": { "type": "string" },
                "confidenceHint": { "type": "string" }
              },
              "required": ["name", "websiteUrl", "whyFit"]
            }
          }
        },
        "required": ["feeds"]
      },
      "temperature": 0.7,
      "inputMapping": {
        "interests": "input.interests",
        "criteria": "input.criteria"
      }
    },
    {
      "id": "resolve_rss_urls",
      "name": "Resolve RSS URLs",
      "type": "transform",
      "inputMapping": {
        "candidates": "steps.generate_candidates.output.feeds"
      }
    },
    {
      "id": "validate_rss",
      "name": "Validate RSS Feeds",
      "type": "transform",
      "inputMapping": {
        "resolvedFeeds": "steps.resolve_rss_urls.output"
      }
    },
    {
      "id": "prune_and_normalize",
      "name": "Prune and Normalize",
      "type": "llm",
      "model": "gpt-4o-mini",
      "promptSystem": "You are an expert at evaluating RSS feeds for quality, relevance, and signal. You can identify low-quality feeds, duplicates, and feeds that don't match the user's criteria.",
      "promptUser": "Review the candidate feeds and validation results. Remove feeds that:\n- Are invalid or inactive\n- Are duplicates (same author/publication)\n- Don't match the user's criteria (STRICTLY enforce criteria restrictions)\n- Have low signal or quality\n\nUser Criteria (MUST ENFORCE STRICTLY):\n{{input.criteria}}\n\nCRITICAL: If the criteria specifies \"ONLY FROM AUTHORS, NOT PUBLICATIONS\" or similar:\n- REMOVE all feeds from publications, news sites, magazines, or multi-author platforms\n- KEEP only feeds from individual authors, bloggers, personal newsletters, or single-author sites\n- Examples to REMOVE: NPR, TechCrunch, Wired, The Verge, Ars Technica, BBC, CNN, etc.\n- Examples to KEEP: Individual Substack authors, personal blogs, individual Medium authors, personal newsletters\n\nCandidate Feeds with Validation:\n{{steps.validate_rss.output}}\n\nReturn a JSON object with a 'feeds' array containing the normalized list. Each feed should have:\n- authorOrBrand: Author or brand name\n- description: Brief description\n- rssUrl: Valid RSS feed URL\n- siteUrl: Main website URL\n- reason: Why this feed was kept (must explain how it matches criteria, especially if criteria restricts to authors only)\n- activityScore: Activity level (high/medium/low) based on validation results",
      "outputSchema": {
        "type": "object",
        "properties": {
          "feeds": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "authorOrBrand": { "type": "string" },
                "description": { "type": "string" },
                "rssUrl": { "type": "string" },
                "siteUrl": { "type": "string" },
                "reason": { "type": "string" },
                "activityScore": { "type": "string" }
              },
              "required": ["authorOrBrand", "rssUrl", "siteUrl"]
            }
          }
        },
        "required": ["feeds"]
      },
      "temperature": 0.3,
      "inputMapping": {
        "criteria": "input.criteria",
        "validationResults": "steps.validate_rss.output"
      }
    },
    {
      "id": "web_refine",
      "name": "Web Search Refinement",
      "type": "tool",
      "toolName": "web_search",
      "inputMapping": {
        "query": "input.interests",
        "limit": "input.searchLimit"
      }
    },
    {
      "id": "integrate_and_rank",
      "name": "Integrate and Rank",
      "type": "llm",
      "model": "gpt-4o",
      "promptSystem": "You are an expert at ranking and curating RSS feeds. You can integrate web search results with validated feeds to create a final, high-quality list that matches the user's criteria.",
      "promptUser": "Using the validated feeds and web search results, create a final ranked list of RSS feeds.\n\nUser Criteria (MUST ENFORCE STRICTLY):\n{{input.criteria}}\n\nCRITICAL: If the criteria specifies \"ONLY FROM AUTHORS, NOT PUBLICATIONS\" or similar:\n- DO NOT include any feeds from publications, news sites, magazines, or multi-author platforms\n- ONLY include feeds from individual authors, bloggers, personal newsletters, or single-author sites\n- If web search results suggest publications, IGNORE them and focus on individual authors\n\nValidated Feeds:\n{{steps.prune_and_normalize.output.feeds}}\n\nWeb Search Results:\n{{steps.web_refine.output}}\n\nReturn a JSON object with a 'feeds' array containing the final ranked list. Each feed should have:\n- authorOrBrand: Author or brand name\n- description: Description\n- rssUrl: RSS feed URL\n- siteUrl: Main website URL\n- activity: Activity level\n- whyItMatchesCriteria: Explanation of why this feed matches the user's criteria (must explicitly state it's an author feed if criteria requires authors only)\n- rank: Rank in the list (1 = best match)\n\nPrioritize feeds that:\n- Match the user's criteria closely (STRICTLY enforce criteria restrictions)\n- Show thought leadership or contrarian views\n- Have high activity and quality\n- Are mentioned positively in web search results\n- Are from individual authors (if criteria requires authors only)",
      "outputSchema": {
        "type": "object",
        "properties": {
          "feeds": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "authorOrBrand": { "type": "string" },
                "description": { "type": "string" },
                "rssUrl": { "type": "string" },
                "siteUrl": { "type": "string" },
                "activity": { "type": "string" },
                "whyItMatchesCriteria": { "type": "string" },
                "rank": { "type": "number" }
              },
              "required": ["authorOrBrand", "rssUrl", "siteUrl", "whyItMatchesCriteria", "rank"]
            }
          }
        },
        "required": ["feeds"]
      },
      "temperature": 0.3,
      "inputMapping": {
        "criteria": "input.criteria",
        "validatedFeeds": "steps.prune_and_normalize.output",
        "webResults": "steps.web_refine.output"
      }
    },
    {
      "id": "final_validate",
      "name": "Final Validation",
      "type": "transform",
      "inputMapping": {
        "rankedFeeds": "steps.integrate_and_rank.output.feeds"
      }
    }
  ]
}
